---
title:  "SSH ä½¿ç”¨è¯¦è§£æ–‡æ¡£"
header:
  teaser: "/assets/images/500x300.png"
categories: 
  - tool
  - tutorial
tags:
  - SSH
  - Linux
  - å®‰å…¨
  - ç½‘ç»œ
date: 2025-06-30
author:  "Cao Jiahao"
---

<!-- # SSH ä½¿ç”¨è¯¦è§£æ–‡æ¡£ -->

> æœ¬æ–‡ç³»ç»Ÿè®²è§£ SSHï¼ˆSecure Shellï¼‰åœ¨ Linux ç³»ç»Ÿä¸­çš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬åŸºç¡€è¿æ¥ã€å¯†é’¥é…ç½®ã€æ–‡ä»¶ä¼ è¾“ã€ç«¯å£è½¬å‘ã€å®‰å…¨é…ç½®ç­‰å†…å®¹ï¼Œé€‚åˆåˆå­¦è€…å…¥é—¨ä¸è¿›é˜¶ç”¨æˆ·å‚è€ƒã€‚

---

## ğŸ“Œ ç›®å½•å¯¼èˆª

- [1. ä»€ä¹ˆæ˜¯ SSHï¼Ÿ](#1-ä»€ä¹ˆæ˜¯-ssh)
- [2. SSH å®‰è£…ä¸å¯åŠ¨](#2-ssh-å®‰è£…ä¸å¯åŠ¨)
- [3. SSH åŸºç¡€ç”¨æ³•](#3-ssh-åŸºç¡€ç”¨æ³•)
- [4. SSH å¯†é’¥ç™»å½•é…ç½®](#4-ssh-å¯†é’¥ç™»å½•é…ç½®)
- [5. SSH æ–‡ä»¶ä¼ è¾“](#5-ssh-æ–‡ä»¶ä¼ è¾“)
- [6. SSH ç«¯å£è½¬å‘](#6-ssh-ç«¯å£è½¬å‘)
- [7. SSH é…ç½®æ–‡ä»¶è¯´æ˜](#7-ssh-é…ç½®æ–‡ä»¶è¯´æ˜)
- [8. SSH å®‰å…¨åŠ å›º](#8-ssh-å®‰å…¨åŠ å›º)
- [9. å¸¸è§é—®é¢˜ä¸æ’æŸ¥](#9-å¸¸è§é—®é¢˜ä¸æ’æŸ¥)
- [10. å‚è€ƒèµ„æº](#10-å‚è€ƒèµ„æº)

---

## 1. ä»€ä¹ˆæ˜¯ SSHï¼Ÿ

**SSHï¼ˆSecure Shellï¼‰** æ˜¯ä¸€ç§åŠ å¯†çš„ç½‘ç»œåè®®ï¼Œç”¨äºåœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸­å®‰å…¨è®¿é—®è¿œç¨‹è®¡ç®—æœºï¼Œé€šå¸¸ç”¨äºè¿œç¨‹ç™»å½•æœåŠ¡å™¨ã€ä¼ è¾“æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œã€‚

SSH å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- æä¾›å¼ºåŠ å¯†çš„è®¤è¯å’Œæ•°æ®ä¼ è¾“
- æ”¯æŒåŸºäºç”¨æˆ·åå¯†ç æˆ–å¯†é’¥çš„èº«ä»½éªŒè¯
- æ”¯æŒç«¯å£è½¬å‘ä¸ä»£ç†éš§é“
- å¯ç”¨äºè¿œç¨‹å‘½ä»¤æ‰§è¡Œä¸å›¾å½¢ç•Œé¢è½¬å‘ï¼ˆX11ï¼‰

---

## 2. SSH å®‰è£…ä¸å¯åŠ¨

### 2.1 Linux å®‰è£…å®¢æˆ·ç«¯ï¼ˆé€šå¸¸é¢„è£…ï¼‰

```bash
sudo apt update
sudo apt install openssh-client
````

### 2.2 å®‰è£…å¹¶å¯åŠ¨æœåŠ¡ç«¯ï¼ˆæœåŠ¡å™¨ï¼‰

```bash
sudo apt install openssh-server
sudo systemctl enable ssh
sudo systemctl start ssh
sudo systemctl status ssh
```

### 2.3 æŸ¥çœ‹ SSH æœåŠ¡ç«¯å£

```bash
sudo netstat -tnlp | grep ssh
# é»˜è®¤ç«¯å£ä¸º 22
```

---

## 3. SSH åŸºç¡€ç”¨æ³•

### 3.1 ç™»å½•è¿œç¨‹æœåŠ¡å™¨

```bash
ssh username@remote_ip
# ç¤ºä¾‹
ssh student@192.168.1.100
```

### 3.2 æŒ‡å®šç«¯å£ç™»å½•

```bash
ssh -p 2222 username@remote_ip
```

### 3.3 æ‰§è¡Œè¿œç¨‹å‘½ä»¤

```bash
ssh username@remote_ip "ls -l /home/username"
```

### 3.4 ä¿æŒè¿æ¥åå°è¿è¡Œ

```bash
ssh -fN username@remote_ip
```

---

## 4. SSH å¯†é’¥ç™»å½•é…ç½®

### 4.1 ç”Ÿæˆ SSH å¯†é’¥å¯¹

```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

é»˜è®¤ç”Ÿæˆæ–‡ä»¶ï¼š

* ç§é’¥ï¼š`~/.ssh/id_rsa`
* å…¬é’¥ï¼š`~/.ssh/id_rsa.pub`

### 4.2 å°†å…¬é’¥ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœº

```bash
ssh-copy-id username@remote_ip
```

æˆ–æ‰‹åŠ¨è¿½åŠ è‡³è¿œç¨‹ä¸»æœºçš„ `~/.ssh/authorized_keys`

### 4.3 æµ‹è¯•å…å¯†ç™»å½•

```bash
ssh username@remote_ip
# ä¸å†éœ€è¦è¾“å…¥å¯†ç 
```

---

## 5. SSH æ–‡ä»¶ä¼ è¾“

### 5.1 ä½¿ç”¨ scpï¼ˆSecure Copyï¼‰

```bash
# ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹
scp localfile.txt user@remote_ip:/path/to/destination

# ä¸‹è½½è¿œç¨‹æ–‡ä»¶åˆ°æœ¬åœ°
scp user@remote_ip:/path/to/file.txt ./localdir
```

### 5.2 ä½¿ç”¨ rsyncï¼ˆå¢é‡ä¼ è¾“ï¼‰

```bash
rsync -avz ./localdir/ user@remote_ip:/path/to/remote/dir/
```

---

## 6. SSH ç«¯å£è½¬å‘

### 6.1 æœ¬åœ°ç«¯å£è½¬å‘ï¼ˆLocal Forwardingï¼‰

```bash
ssh -L 8080:localhost:80 user@remote_ip
# å°†æœ¬åœ°8080ç«¯å£æ˜ å°„åˆ°è¿œç¨‹æœåŠ¡å™¨çš„80ç«¯å£
```

### 6.2 è¿œç¨‹ç«¯å£è½¬å‘ï¼ˆRemote Forwardingï¼‰

```bash
ssh -R 9090:localhost:3000 user@remote_ip
# å°†è¿œç¨‹9090ç«¯å£æ˜ å°„åˆ°æœ¬åœ°3000ç«¯å£
```

### 6.3 åŠ¨æ€ç«¯å£è½¬å‘ï¼ˆSOCKS ä»£ç†ï¼‰

```bash
ssh -D 1080 user@remote_ip
# æœ¬åœ°å¼€å¯ä¸€ä¸ª SOCKS5 ä»£ç†
```

---

## 7. SSH é…ç½®æ–‡ä»¶è¯´æ˜

é…ç½®è·¯å¾„ï¼š`~/.ssh/config`

```ini
# ç¤ºä¾‹ï¼šå¤šä¸»æœºè‡ªåŠ¨é…ç½®
Host lab
    HostName 192.168.1.100
    User student
    Port 22
    IdentityFile ~/.ssh/id_rsa

Host aws
    HostName ec2-3-123-456.compute.amazonaws.com
    User ubuntu
    IdentityFile ~/.ssh/aws.pem
```

è¿æ¥æ–¹å¼ï¼š

```bash
ssh lab
ssh aws
```

---

## 8. SSH å®‰å…¨åŠ å›º

### 8.1 ä¿®æ”¹é»˜è®¤ç«¯å£ï¼ˆå¦‚ 2222ï¼‰

```bash
sudo vim /etc/ssh/sshd_config
# Port 2222
sudo systemctl restart ssh
```

### 8.2 ç¦ç”¨ root ç™»å½•

```bash
# åœ¨ sshd_config ä¸­è®¾ç½®ï¼š
PermitRootLogin no
```

### 8.3 ç¦ç”¨å¯†ç ç™»å½•ï¼ˆåªå…è®¸å¯†é’¥ï¼‰

```bash
PasswordAuthentication no
```

### 8.4 é…ç½®é˜²ç«å¢™è§„åˆ™ï¼ˆå¦‚ UFWï¼‰

```bash
sudo ufw allow 2222/tcp
sudo ufw enable
```

---

## 9. å¸¸è§é—®é¢˜ä¸æ’æŸ¥

| é—®é¢˜                               | å¯èƒ½åŸå›        | è§£å†³æ–¹æ¡ˆ                           |
| -------------------------------- | ---------- | ------------------------------ |
| Connection refused               | SSH æœåŠ¡æœªå¯åŠ¨  | `sudo systemctl start ssh`     |
| Permission denied                | æƒé™é”™è¯¯/å¯†é’¥æ— æ•ˆ  | æ£€æŸ¥å¯†é’¥æƒé™ã€authorized\_keys æ˜¯å¦æ­£ç¡®   |
| è¶…æ—¶                               | ç½‘ç»œä¸é€šæˆ–é˜²ç«å¢™   | æ£€æŸ¥ç½‘ç»œã€é˜²ç«å¢™ç«¯å£æ˜¯å¦å¼€æ”¾                 |
| Too many authentication failures | SSH å°è¯•æ¬¡æ•°è¿‡å¤š | ä½¿ç”¨ `IdentitiesOnly=yes` é™åˆ¶å¯†é’¥å°è¯• |

---

## 10. å‚è€ƒèµ„æº

* [OpenSSH å®˜ç½‘](https://www.openssh.com/)
* [SSH Config æ–‡æ¡£](https://man.openbsd.org/ssh_config)
* [Linux ssh å‘½ä»¤è¯¦è§£ - Linuxize](https://linuxize.com/post/how-to-use-ssh/)

---

> ğŸ“Œ æç¤ºï¼šå»ºè®®ä¸ºé‡è¦æœåŠ¡å™¨é…ç½® Fail2banã€è®¾ç½®ç™»å½•è­¦æŠ¥ã€å®šæœŸæ£€æŸ¥ authorized\_keys æ–‡ä»¶ç­‰ã€‚

```